<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daftar Stok â€” JBAllGameByLungzzAndAmbaJb</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <header class="site-header">
    <h1>Stock</h1>
  </header>

  <main class="wrap">
    <h2 class="page-title">ðŸ“¦ Stok Terbaru</h2>
    <div id="stok-container" class="news-list"></div>
  </main>

  <footer class="footer">
    <small>By Lungzz</small>
  </footer>

  <script>
    async function loadStok() {
      try {
        const res = await fetch('/api/stok');
        const data = await res.json();
        const cont = document.getElementById('stok-container');
        cont.innerHTML = '';
        if (!data.length) {
          cont.innerHTML = '<p class="muted">Belum ada stok.</p>';
          return;
        }
        data.forEach(s => {
          const card = document.createElement('article');
          card.className = 'news-card';
          card.innerHTML = `
            <h3 class="news-title">${escapeHtml(s.nama)}</h3>
            <p class="news-meta">Harga: Rp${numberWithCommas(s.harga)} â€¢ Stok: ${s.stock ?? 0}</p>
            <p class="news-desc">${escapeHtml(s.deskripsi || '')}</p>
            <p class="news-wa">ðŸ“² <a href="https://wa.me/${encodeURIComponent(s.wa || '')}" target="_blank" rel="noopener">Chat via WhatsApp</a></p>
          `;
          cont.appendChild(card);
        });
      } catch (e) {
        console.error(e);
        document.getElementById('stok-container').innerText = 'Gagal load stok.';
      }
    }

    function escapeHtml(s){
      if (!s) return '';
      return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function numberWithCommas(x){ return String(x).replace(/\B(?=(\d{3})+(?!\d))/g, "."); }

    loadStok();
  </script>
</body>
</html>
